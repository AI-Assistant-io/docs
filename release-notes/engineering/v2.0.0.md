# Release v2.0.0

**Release Date:** 2026-01-29

---

## Major Features

### Systems Layer (Issue #50)
Introduces a hierarchical "Systems" layer between Clients and Test Cases, enabling multi-store testing and better organization of API tests.

#### Systems Management
- **Sync from Vision API**: Import systems (external API endpoints) from Vision API for each client
- **System Variables**: Each system has its own variables that override client variables
- **Variable Priority**: Global Variables → Client Variables → System Variables (highest priority)
- **System Detail Page**: New `/systems/:id` route with tabs for Test Cases, Test Runs, and Variables

#### Multi-Store Testing
- **Store IDs**: Associate multiple store IDs with a system for batch testing
- **Batch Test Runs**: Run tests across all store IDs with `storeId` injected as highest-priority variable
- **Test Run Batches**: Group test runs by batch for reporting

### Dynamic Variables
Runtime-computed variables for test cases:
- `{{today}}` - Today's date (YYYY-MM-DD)
- `{{todayISO}}` - ISO format datetime
- `{{todayUTC}}` - UTC format datetime
- `{{timestamp}}` - Unix timestamp (ms)
- `{{timestampSeconds}}` - Unix timestamp (seconds)
- `{{year}}`, `{{month}}`, `{{day}}`, `{{hour}}`, `{{minute}}`, `{{second}}`
- `{{uuid}}` - Random UUID
- `{{randomNumber}}` - Random 6-digit number

#### Date Arithmetic
- `{{today+7}}` - 7 days from today
- `{{today-3}}` - 3 days ago
- `{{timestamp+3600000}}` - 1 hour from now (in ms)

### Template Auto-Sync
- **Automatic Propagation**: When a template is added to a group, it auto-syncs to all systems/clients using that group
- **Update Check**: Editing a template also checks and adds it to any missing systems/clients
- **Toast Notifications**: Frontend shows sync results ("Synced to X systems and Y clients")

### Azure Resources Quick Access
- **Summary Card**: Azure Resources status card on Test Cases tab
- **Quick Status**: Shows Resource Group status (Active/Not Created/Not Configured)
- **Manage Button**: Quick navigation to Azure Resources tab

---

## UI Improvements

### Variable Autocomplete
- Dynamic variables now appear in autocomplete when typing `{{`
- Shows "(dynamic)" prefix with description for built-in variables
- Available in endpoint, headers, query params, and body fields

### Extract Variables Editor
- Visual `{{` and `}}` brackets around variable names
- Updated help text explaining variable usage format

### Dashboard Enhancements
- System health cards showing pass rates
- Client aggregate health summary

### Vision API Import Fixes
- Case-insensitive client ID matching
- Correctly identifies already-imported clients

---

## Technical Changes

### Database Migrations
- `023_add_systems_layer.sql` - Systems and SystemVariables tables
- `024_remove_visionId_from_systems.sql` - Schema cleanup
- `025_add_global_variable_targets.sql` - Variable targeting
- `026_add_system_store_ids.sql` - SystemStoreIds table
- `027_add_test_run_batches.sql` - TestRunBatches table

### New Backend Files
- `systemsController.ts` - Systems CRUD operations
- `systemVariablesController.ts` - System variables management
- `systemStoreIdController.ts` - Store ID management
- `systemsSyncController.ts` - Vision API sync for systems
- `systemsApiService.ts` - Vision API integration for systems

### New Frontend Files
- `SystemDetail.tsx` - System detail page with tabs
- `SyncSystemsModal.tsx` - Modal for syncing systems from Vision
- `constants/dynamicVariables.ts` - Dynamic variable definitions

### API Endpoints
| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/clients/:clientId/systems` | List systems for client |
| GET | `/systems/:id` | Get system details |
| POST | `/systems` | Create system |
| DELETE | `/systems/:id` | Delete system |
| GET | `/systems/:systemId/variables` | Get system variables |
| POST | `/system-variables` | Create system variable |
| DELETE | `/system-variables/:id` | Delete system variable |
| POST | `/clients/:clientId/systems/preview` | Preview available systems |
| POST | `/clients/:clientId/systems/sync` | Sync selected systems |
| GET | `/systems/:systemId/test-cases` | Get test cases for system |
| GET | `/systems/:systemId/test-runs` | Get test runs for system |
| POST | `/systems/:systemId/store-ids` | Add store ID |
| DELETE | `/system-store-ids/:id` | Delete store ID |
| POST | `/systems/:systemId/test-runs/batch` | Start batch test run |

---

## Breaking Changes

None - all changes are additive. Existing clients and test cases continue to work without systems.

---

## Contributors

- Development assisted by Claude Opus 4.5
